### E-Book2PDF 프로젝트 유지보수 문서

이 문서는 미래의 Gemini 에이전트가 이 프로젝트의 컨텍스트를 빠르게 파악하고, 과거에 발생했던 문제를 재발시키지 않도록 돕기 위해 작성되었습니다.

---

### 1. 핵심 아키텍처

- **GUI**: `customtkinter`를 사용한 단일 창 애플리케이션.
- **핵심 로직**: `ScreenshotWorker` (threading.Thread) 클래스가 백그라운드에서 작업을 수행.
- **스크린샷 방식**: `pyautogui.screenshot()`으로 전체 화면을 캡처한 후, `Pillow` 라이브러리의 `crop()`을 이용해 사용자가 지정한 영역을 잘라내는 **후처리 방식**을 사용. (macOS 호환성 문제로 이 방식 채택)

---

### 2. 주요 문제 및 해결 과정 (매우 중요)

#### 가. **macOS 권한 및 충돌 문제**
- **문제점**: `pyautogui`의 특정 기능(`region` 파라미터)과 `pynput` 라이브러리가 macOS의 보안 정책 및 이벤트 시스템과 충돌하여 앱이 예기치 않게 강제 종료되거나 멈추는 현상이 반복적으로 발생했음.
- **해결책**:
    1.  **`pynput` 완전 제거**: 안정성을 위해 '아무 키나 눌러 종료' 기능을 포기하고 라이브러리 의존성을 제거함.
    2.  **전체 화면 캡처 후 자르기**: `pyautogui.screenshot(region=...)` 대신, 전체 화면을 캡처하고 `Pillow`로 후처리하는 방식으로 변경하여 OS와의 충돌을 최소화함. 이것이 현재 아키텍처의 핵심임.

#### 나. **Retina 디스플레이 좌표 불일치 문제**
- **문제점**: 고해상도(Retina) 디스플레이에서 논리적 좌표(UI에 표시되는 값)와 물리적 픽셀(실제 스크린샷 이미지) 간의 배율 차이로 인해, 의도한 영역과 전혀 다른 곳이 잘리는 현상이 발생했음.
- **시도 1 (실패)**: `pyautogui.size()`와 `winfo_screenwidth()`를 나누어 배율을 계산했으나, 부정확하고 여러 모니터 환경에서 오작동할 가능성이 있어 실패함.
- **해결책 (현재 방식)**: `customtkinter`가 직접 제공하는 배율 정보를 사용하는 것이 가장 안정적임. `self.tk.call('tk', 'scaling')`을 통해 현재 창이 표시된 화면의 정확한 스케일링 팩터를 얻어와 모든 좌표 계산에 적용함.

---

### 3. 개발 규칙

- **GUI 앱 실행 금지**: 이 프로젝트는 GUI 앱이므로, `run_shell_command`로 `python3 app.py`를 실행하지 말 것. (무한 로딩 발생)
- **README.md는 사용자를 위해**: `README.md`에는 사용법, 설치, 문제 해결 등 사용자에게 필요한 정보만 남기고, 개발 과정이나 변경 내역은 기록하지 말 것.
- **이 문서(gemini.md)를 먼저 읽고 업데이트할 것**: 모든 작업 시작 전 이 문서를 읽어 컨텍스트를 파악하고, 작업 완료 후에는 변경된 내용이나 새로 발견한 문제점을 이 문서에 반드시 기록하여 연속성을 유지할 것.
