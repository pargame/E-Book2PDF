### E-Book2PDF 프로젝트 유지보수 문서 (v2.0)

이 문서는 미래의 Gemini 에이전트가 이 프로젝트의 컨텍스트를 빠르게 파악하고, 안정화된 현재 아키텍처를 이해하여 과거의 실수를 반복하지 않도록 돕기 위해 작성되었습니다.

---

### 1. 최종 아키텍처 (macOS Retina 최적화)

- **핵심 전략**: **논리적 좌표(Point)와 물리적 좌표(Pixel)의 불일치** 문제를 해결하는 것이 이 프로젝트의 가장 중요한 과제였습니다.
- **스케일 팩터 자동 감지**:
    - 앱 시작 시, `App` 클래스는 `Foundation.NSScreen.mainScreen().backingScaleFactor()`를 통해 현재 디스플레이의 스케일 팩터(예: Retina의 경우 `2.0`)를 자동으로 감지하여 `self.scale_factor`에 저장합니다.
- **좌표 캡처**:
    - 사용자의 모든 좌표 입력(`스크린샷 범위`, `클릭 위치`)은 `pyautogui.position()`을 통해 **논리적 좌표(Point)**로 캡처됩니다. 이 방식은 가장 단순하고 안정적입니다.
- **픽셀 좌표 변환**:
    - **이미지를 자르기 직전**(`show_preview`, `process_and_convert_to_pdf`)에, 저장된 논리 좌표에 `self.scale_factor`를 곱하여 **실제 물리적 픽셀 좌표**로 변환합니다.
    - `crop_box = (int(logical_x * scale), int(logical_y * scale), ...)`

이 **`감지 -> 논리 캡처 -> 픽셀 변환`** 방식이 현재의 가장 안정적이고 정확한 아키텍처입니다.

---

### 2. 주요 문제 해결의 역사

1.  **초기 문제**: Retina 디스플레이에서 스크린샷 영역이 의도한 것보다 훨씬 작게 잘리는 현상 발생.
2.  **시도 1 (실패)**: `pyautogui`의 `region` 파라미터와 오버레이 창(`CTkToplevel`)을 사용했으나, macOS의 보안 정책 및 창 관리 시스템과 충돌하여 앱이 반복적으로 강제 종료됨.
3.  **시도 2 (실패)**: 오버레이를 제거하고, macOS의 네이티브 `Quartz` API를 사용하여 마우스의 **물리적 픽셀 좌표**를 직접 읽으려고 시도함. 이는 개념적으로는 정확했으나, `pyautogui.screenshot()`이 사용하는 좌표계와 미세한 불일치가 발생하고 코드 복잡도가 불필요하게 증가하여 폐기함.
4.  **최종 해결책 (현재 방식)**: 위 `1. 최종 아키텍처`에서 설명한 방식으로 회귀 및 안정화. 이것이 가장 표준적이고 확실한 방법임이 증명됨.

---

### 3. 핵심 개발 규칙

- **GUI 앱 실행 금지**: 이 프로젝트는 GUI 앱이므로, `run_shell_command`로 `python3 app.py`를 실행하지 말 것. (무한 로딩 발생)
- **스케일링 로직 유지**: 현재의 스케일 팩터 처리 방식은 macOS 환경의 핵심이므로, 임의로 네이티브 좌표를 직접 읽는 방식으로 회귀하지 말 것.
- **이 문서(gemini.md)를 먼저 읽고 업데이트할 것**: 모든 작업 시작 전 이 문서를 읽어 컨텍스트를 파악하고, 작업 완료 후에는 변경된 내용이나 새로 발견한 문제점을 이 문서에 반드시 기록하여 연속성을 유지할 것.